<!-- src/app/quimico-estoque/quimico-estoque.component.html -->

<div class="mb-3 d-flex align-items-center gap-2">
  <h5 class="mb-0">Estoque Atual</h5>
  <span *ngIf="carregando" class="spinner-border spinner-border-sm text-secondary" role="status"></span>
</div>

<!-- ====== ALERTAS DE ESTOQUE BAIXO ====== -->
<div class="row g-3 mb-4">
  <div class="col-12">
    <div class="card shadow-sm border-0">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h6 class="m-0">‚ö†Ô∏è Qu√≠micos com estoque baixo</h6>
          <small class="text-muted">Cr√≠tico &lt; 20 | Alerta &lt; 40</small>
        </div>

        <ng-container *ngIf="quimicosBaixoEstoque.length > 0; else nenhumBaixo">
          <div class="d-flex flex-wrap gap-2">
            <div
              *ngFor="let q of quimicosBaixoEstoque"
              class="border rounded px-3 py-2 d-flex flex-column gap-1"
              [ngClass]="{
                'border-danger-subtle bg-danger-subtle bg-opacity-10': q.nivel==='CRITICO',
                'border-warning-subtle bg-warning-subtle bg-opacity-10': q.nivel==='ALERTA'
              }"
              style="min-width: 210px;"
            >
              <div class="d-flex justify-content-between align-items-center gap-2">
                <span class="fw-semibold">{{ q.item.tipoQuimico }}</span>
                <span class="badge" [ngClass]="getBadgeClass(q.nivel)">
                  {{ q.nivel === 'CRITICO' ? 'Cr√≠tico' : 'Alerta' }}
                </span>
              </div>
              <div class="small text-muted">
                Fornecedor: {{ q.item.fornecedor?.nome || '‚Äî' }}
              </div>
              <div class="small">
                Estoque: <strong>{{ q.item.estoqueInicial }}</strong> {{ q.item.unidade }}
              </div>
              <div class="small text-muted" *ngIf="q.item.estadoLocalArmazenamento">
                Estado: {{ q.item.estadoLocalArmazenamento }}
              </div>
            </div>
          </div>
        </ng-container>

        <ng-template #nenhumBaixo>
          <p class="text-muted mb-0">‚úÖ Nenhum qu√≠mico abaixo de 40 no momento.</p>
        </ng-template>
      </div>
    </div>
  </div>
</div>

<!-- ====== LISTAGEM AGRUPADA (tipo x estado) ====== -->
<div class="card shadow-sm border-0">
  <div class="card-body">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h6 class="m-0">üì¶ Estoque consolidado por tipo e regi√£o</h6>
      <small class="text-muted">{{ estoqueAgrupado.length }} registros</small>
    </div>

    <div class="row g-3">
      <div
        class="col-12 col-md-6 col-lg-4"
        *ngFor="let e of estoqueAgrupado"
      >
        <div class="border rounded p-3 h-100 bg-light-subtle">
          <div class="d-flex justify-content-between align-items-start mb-2">
            <span class="fw-semibold text-uppercase">{{ e.tipoQuimico }}</span>
            <span class="badge bg-secondary-subtle text-secondary border border-secondary">
              {{ formatEstado(e.estadoLocalArmazenamento) }}
            </span>
          </div>
          <div class="d-flex flex-column">
            <span class="text-muted small mb-1">Estoque total</span>
            <span class="fs-5 fw-bold">{{ e.estoqueTotal }}</span>
          </div>
        </div>
      </div>

      <div *ngIf="!carregando && estoqueAgrupado.length === 0" class="col-12">
        <p class="text-muted mb-0">Nenhum dado consolidado de estoque foi encontrado.</p>
      </div>
    </div>
  </div>
</div>
