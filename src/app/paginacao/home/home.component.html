<div class="shell">
  <app-header class="header"></app-header>

  <aside class="sidebar">
    <app-menu-lateral></app-menu-lateral>
  </aside>

  <main class="content">
    <div class="container-fluid p-lg-5 p-4">
      
      <div class="d-flex align-items-center justify-content-between mb-5">
        <div>
          <h2 class="page-title">Dashboard</h2>
          <p class="text-muted m-0 small">VisÃ£o geral operacional</p>
        </div>
        <div *ngIf="carregando" class="spinner-border spinner-border-sm text-primary"></div>
      </div>

      <div class="row g-4">
        
        <div class="col-12 col-xl-8 d-flex flex-column gap-4">
          
          <div class="card-minimal accent-danger">
            <div class="card-header-clean">
              <h6 class="title text-danger">Estoque CrÃ­tico</h6>
              <span class="badge-pill">{{ quimicosBaixoEstoque.length }} itens</span>
            </div>
            
            <table class="table table-hover table-clean mb-0">
              <thead>
                <tr>
                  <th class="ps-4">Item</th>
                  <th>Status</th>
                  <th class="text-end pe-4">Qtd.</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let qb of quimicosBaixoEstoque">
                  <td class="ps-4">
                    <span class="fw-medium text-dark">{{ nomeOf(qb.item) }}</span>
                    <small class="d-block text-muted" style="font-size: 0.75rem;">{{ tipoOf(qb.item) }}</small>
                  </td>
                  <td>
                    <span class="status-tag" 
                      [ngClass]="qb.nivel === 'CRITICO' ? 'status-critical' : 'status-warning'">
                      {{ qb.nivel }}
                    </span>
                  </td>
                  <td class="text-end pe-4 font-monospace fw-bold text-secondary">
                    {{ fmt(qb.estoqueAtual) }}
                  </td>
                </tr>
                <tr *ngIf="!carregando && quimicosBaixoEstoque.length === 0">
                  <td colspan="3" class="text-center py-5 text-muted small">Estoque regularizado.</td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="card-minimal accent-warning">
            <div class="card-header-clean">
              <h6 class="title text-warning-dark">Vencimentos PrÃ³ximos</h6>
              <span class="badge-pill">{{ quimicosVencimento.length }} lotes</span>
            </div>

            <div class="list-group list-group-flush rounded-bottom-3">
              <div *ngFor="let v of quimicosVencimento" class="list-group-item border-0 px-4 py-3 item-hover">
                <div class="d-flex justify-content-between align-items-center">
                  <div class="d-flex align-items-center gap-3">
                    <div class="icon-box bg-light text-muted">ðŸ“…</div> <div>
                      <span class="d-block fw-medium text-dark">{{ nomeOf(v.item) }}</span>
                      <small class="text-muted">Lote: {{ loteOf(v.item) }}</small>
                    </div>
                  </div>
                  <div class="text-end">
                    <span class="days-left" [class.text-danger]="v.nivel === 'CRITICO'">
                      {{ labelDias(v.diasRestantes) }}
                    </span>
                    <small class="d-block text-muted x-small">{{ dateYMD(v.item.dataValidade) }}</small>
                  </div>
                </div>
              </div>
              <div *ngIf="!carregando && quimicosVencimento.length === 0" class="p-4 text-center text-muted small">
                Nenhum vencimento prÃ³ximo.
              </div>
            </div>
          </div>

        </div>

        <div class="col-12 col-xl-4">
          <div class="card-minimal accent-primary h-100">
            <div class="card-header-clean border-bottom-0 pb-0">
              <h6 class="title text-primary">Ãšltimos Reportes</h6>
              <span class="badge-pill bg-primary-subtle text-primary">{{ reportesNovos.length }} novos</span>
            </div>
            
            <div class="p-4">
              <div class="timeline">
                <div *ngFor="let rep of reportesNovos" class="timeline-block">
                  <div class="marker"></div>
                  <div class="content-box">
                    <div class="d-flex justify-content-between mb-1">
                      <span class="author">{{ rep.matricula }}</span>
                      <span class="date">{{ formatDateReporte(rep.dataHoraReporte) }}</span>
                    </div>
                    <p class="msg">{{ rep.mensagem }}</p>
                    <span class="dept-badge">{{ rep.setor }}</span>
                  </div>
                </div>
                
                <div *ngIf="!carregando && reportesNovos.length === 0" class="text-center text-muted py-4">
                  <small>Sem novas ocorrÃªncias.</small>
                </div>
              </div>
            </div>
          </div>
        </div>

      </div> 
    </div>
  </main>
</div>