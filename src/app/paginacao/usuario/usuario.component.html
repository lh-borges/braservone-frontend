<div class="shell">
  <app-header class="header"></app-header>

  <aside class="sidebar border-end">
    <app-menu-lateral></app-menu-lateral>
  </aside>

  <main class="content">
    <div class="container-fluid p-4">
      
      <div *ngIf="loading && !user" class="text-center py-5">
        <div class="spinner-border text-primary" role="status"></div>
        <p class="mt-2 text-muted">Carregando seus dados...</p>
      </div>

      <div *ngIf="errorMsg" class="alert alert-danger" role="alert">
        {{ errorMsg }}
      </div>

      <div class="row" *ngIf="user">
        
        <div class="col-12 mb-4">
          <div class="card shadow-sm">
            <div class="card-header bg-white py-3">
              <h5 class="card-title mb-0 text-primary">
                <i class="bi bi-person-circle me-2"></i>Meus Dados
              </h5>
            </div>
            <div class="card-body">
              
              <form (ngSubmit)="updateUser()" #formUser="ngForm">
                <div class="row g-3">
                  
                  <div class="col-md-4">
                    <label class="form-label text-muted small">Usuário (Login)</label>
                    <input 
                      type="text" 
                      class="form-control bg-light" 
                      name="username" 
                      [(ngModel)]="user.username" 
                      readonly 
                      disabled
                      title="O nome de usuário não pode ser alterado"
                    >
                  </div>

                  <div class="col-md-4">
                    <label class="form-label">Nome Completo</label>
                    <input 
                      type="text" 
                      class="form-control" 
                      name="nome" 
                      [(ngModel)]="user.nome" 
                      required
                      [disabled]="loading"
                    >
                  </div>

                  <div class="col-md-4">
                    <label class="form-label">E-mail</label>
                    <input 
                      type="email" 
                      class="form-control" 
                      name="email" 
                      [(ngModel)]="user.email" 
                      required
                      email
                      [disabled]="loading"
                    >
                  </div>

                </div>

                <div class="d-flex justify-content-end align-items-center mt-4 border-top pt-3">
                  
                  <span *ngIf="saveSuccess" class="text-success me-3 fw-bold fade-in">
                    <i class="bi bi-check-lg"></i> Dados atualizados com sucesso!
                  </span>

                  <button 
                    type="submit" 
                    class="btn btn-primary" 
                    [disabled]="loading || formUser.invalid"
                  >
                    <span *ngIf="loading" class="spinner-border spinner-border-sm me-1"></span>
                    Salvar Alterações
                  </button>
                </div>
              </form>

            </div>
          </div>
        </div>

        <div class="col-12">
          <div class="card shadow-sm border-warning">
            <div class="card-header bg-white py-3">
              <h5 class="card-title mb-0 text-warning-emphasis">
                <i class="bi bi-shield-lock me-2"></i>Segurança
              </h5>
            </div>
            <div class="card-body">
              
              <form (ngSubmit)="changePassword()" #formPwd="ngForm">
                <div class="row g-3 align-items-end">
                  
                  <div class="col-md-3">
                    <label class="form-label">Senha Atual</label>
                    <input 
                      type="password" 
                      class="form-control" 
                      name="oldPassword" 
                      [(ngModel)]="oldPassword" 
                      required
                    >
                  </div>

                  <div class="col-md-3">
                    <label class="form-label">Nova Senha</label>
                    <input 
                      type="password" 
                      class="form-control" 
                      name="password" 
                      [(ngModel)]="password" 
                      required 
                      minlength="6"
                    >
                  </div>

                  <div class="col-md-3">
                    <label class="form-label">Confirmar Nova Senha</label>
                    <input 
                      type="password" 
                      class="form-control" 
                      name="confirmPassword" 
                      [(ngModel)]="confirmPassword" 
                      required 
                      [class.is-invalid]="confirmPassword && password !== confirmPassword"
                    >
                    <div class="invalid-feedback">As senhas não conferem.</div>
                  </div>

                  <div class="col-md-3">
                    <button 
                      type="submit" 
                      class="btn btn-warning w-100"
                      [disabled]="!formPwd.valid || password !== confirmPassword"
                    >
                      Alterar Senha
                    </button>
                  </div>

                </div>

                <div class="mt-3">
                  <div *ngIf="pwdSuccess" class="alert alert-success py-2 mb-0">
                    <i class="bi bi-check-circle me-1"></i> Senha alterada com sucesso.
                  </div>
                  <div *ngIf="pwdError" class="alert alert-danger py-2 mb-0">
                    <i class="bi bi-exclamation-triangle me-1"></i> {{ pwdError }}
                  </div>
                </div>

              </form>

            </div>
          </div>
        </div>

      </div> </div>
  </main>
</div>