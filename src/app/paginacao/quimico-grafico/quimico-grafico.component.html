<!-- Barra de filtros -->
<div class="bg-white border rounded p-3 mb-3">
  <div class="row g-3 align-items-end">
    <div class="col-md-2">
      <label class="form-label">Início</label>
      <input type="date" class="form-control" [(ngModel)]="startDateStr" (change)="aplicarFiltros()">
    </div>
    <div class="col-md-2">
      <label class="form-label">Fim</label>
      <input type="date" class="form-control" [(ngModel)]="endDateStr" (change)="aplicarFiltros()">
    </div>

    <!-- Tipos de Químico (multi) -->
    <div class="col-md-4">
      <div class="d-flex align-items-center gap-3 mb-1">
        <label class="form-label m-0">Tipos de Químico</label>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="chkAllTipos"
                 [(ngModel)]="allTipos" (ngModelChange)="toggleAllTipos($event)">
          <label class="form-check-label" for="chkAllTipos">Todos os tipos</label>
        </div>
      </div>
      <div class="d-flex gap-2">
        <select class="form-select flex-grow-1" [disabled]="allTipos" multiple size="6"
                [(ngModel)]="selectedTipos" (ngModelChange)="aplicarFiltros()">
          <option *ngFor="let t of tiposOptions" [ngValue]="t">{{ t }}</option>
        </select>
        <div class="d-flex flex-column gap-2">
          <button type="button" class="btn btn-outline-secondary btn-sm"
                  [disabled]="allTipos || !tiposOptions.length"
                  (click)="selecionarTodosTipos()">Selecionar todos</button>
          <button type="button" class="btn btn-outline-secondary btn-sm"
                  [disabled]="allTipos || !selectedTipos.length"
                  (click)="limparSelecaoTipos()">Limpar seleção</button>
        </div>
      </div>
    </div>

    <!-- Poços (multi) -->
    <div class="col-md-4">
      <div class="d-flex align-items-center gap-3 mb-1">
        <label class="form-label m-0">Poços</label>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="chkAllPocos"
                 [(ngModel)]="allPocos" (ngModelChange)="toggleAllPocos($event)">
          <label class="form-check-label" for="chkAllPocos">Todos os poços</label>
        </div>
      </div>
      <div class="d-flex gap-2">
        <select class="form-select flex-grow-1" [disabled]="allPocos" multiple size="6"
                [(ngModel)]="selectedPocos" (ngModelChange)="aplicarFiltros()">
          <option *ngFor="let p of pocosOptions" [ngValue]="p.codigoAnp">
            {{ p.codigoAnp }}{{ p.nome ? (' — ' + p.nome) : '' }}
          </option>
        </select>
        <div class="d-flex flex-column gap-2">
          <button type="button" class="btn btn-outline-secondary btn-sm"
                  [disabled]="allPocos || !pocosOptions.length"
                  (click)="selecionarTodosPocos()">Selecionar todos</button>
          <button type="button" class="btn btn-outline-secondary btn-sm"
                  [disabled]="allPocos || !selectedPocos.length"
                  (click)="limparSelecaoPocos()">Limpar seleção</button>
        </div>
      </div>
    </div>

    <div class="col-12 d-flex gap-2 justify-content-end">
      <button class="btn btn-primary" (click)="aplicarFiltros()">Aplicar</button>
      <button class="btn btn-outline-secondary" (click)="limparFiltros()">Limpar</button>
    </div>
  </div>
</div>

<!-- Estado de erro/carregando -->
<div *ngIf="errorMsg" class="alert alert-danger">{{ errorMsg }}</div>
<div *ngIf="loading" class="alert alert-info">Carregando dados…</div>

<!-- Grid de gráficos -->
<div class="row g-3">
  <div class="col-lg-6">
    <div class="border rounded p-3 h-100">
      <h6 class="mb-3">Entradas vs Saídas por dia</h6>
      <div style="height: 300px">
        <canvas baseChart [type]="barDiaTipoType" [data]="barDiaTipoData" [options]="barDiaTipoOpts"></canvas>
      </div>
    </div>
  </div>

  <div class="col-lg-6">
    <div class="border rounded p-3 h-100">
      <h6 class="mb-3">Consumo (SAÍDA) por Químico</h6>
      <div style="height: 300px">
        <canvas baseChart [type]="barSaidaPorQuimicoType" [data]="barSaidaPorQuimicoData" [options]="barSaidaPorQuimicoOpts"></canvas>
      </div>
    </div>
  </div>

  <div class="col-lg-6">
    <div class="border rounded p-3 h-100">
      <h6 class="mb-3">SAÍDA por Poço</h6>
      <div style="height: 300px">
        <canvas baseChart [type]="doughnutPocoType" [data]="doughnutPocoData" [options]="doughnutPocoOpts"></canvas>
      </div>
    </div>
  </div>

  <div class="col-lg-6">
    <div class="border rounded p-3 h-100">
      <h6 class="mb-3">Acumulado de SAÍDA</h6>
      <div style="height: 300px">
        <canvas baseChart [type]="lineAcumuladoType" [data]="lineAcumuladoData" [options]="lineAcumuladoOpts"></canvas>
      </div>
    </div>
  </div>

  <div class="col-lg-6">
    <div class="border rounded p-3 h-100">
      <h6 class="mb-3">Consumo por Fornecedor</h6>
      <div style="height: 300px">
        <canvas baseChart [type]="barFornecedorType" [data]="barFornecedorData" [options]="barFornecedorOpts"></canvas>
      </div>
    </div>
  </div>

  <div class="col-lg-6">
    <div class="border rounded p-3 h-100">
      <h6 class="mb-3">Totais por Tipo de Movimento</h6>
      <div style="height: 300px">
        <canvas baseChart [type]="polarTipoType" [data]="polarTipoData" [options]="polarTipoOpts"></canvas>
      </div>
    </div>
  </div>

  <div class="col-12">
    <div class="border rounded p-3 h-100">
      <h6 class="mb-3">SAÍDA por Unidade</h6>
      <div style="height: 320px">
        <canvas baseChart [type]="radarUnidadeType" [data]="radarUnidadeData" [options]="radarUnidadeOpts"></canvas>
      </div>
    </div>
  </div>
</div>
